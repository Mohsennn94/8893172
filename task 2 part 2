#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define numOfStudents 10
#define numOfSubjects 3

 typedef struct {
    char firstName[30];
    char lastName[30];
    int studentID;
    float SubjectMarks[numOfSubjects];
    float aggregateMarks;
    char grade[15];
} student;

void enrol(Student students[], int n);
void searchUpdate(Student students[], int n);
void topStudents(Student students[], int n);
void calcGrade(Student *s);
bool validMark(float mark);
int findStudentByID(Student students[], int n, int id);
int findStudentByLastName(Student students[], int n, char *lname);

int main() {
   Student students[numOfStudents] = {0};
    int choice;

    printf("=== Student Record Management ===\n");

    do {
        printf("\nMenu:\n");
        printf("1. Enrol Student Marks\n");
        printf("2. Search and Update Student\n");
        printf("3. Display Top Student(s)\n");
        printf("4. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

    switch(choice) {
            case 1:
                enrol(students, numOfStudents);
                break;
            case 2:
                searchUpdate(students, numOfStudents);
                break;
            case 3:
                topStudents(students, numOfStudents);
                break;
            case 4:
                printf("Exiting program...\n");
                break;
            default:
                printf("Invalid choice. Try again.\n");
        }
    } while(choice != 4);

    return 0;
}

bool validMark(float mark) {
    return (mark >= 0.0 && mark <= 100.0);
}
int findStudentByID(Student students[], int n, int id) {
    for(int i = 0; i < n; i++) {
        if(students[i].studentID == id)
            return i;
    }
    return -1;
}

int findStudentByLastName(Student students[], int n, char *lname) {
    for(int i = 0; i < n; i++) {
        if(strcasecmp(students[i].lastName, lname) == 0)
            return i;
    }
    return -1;
}

void calcGrade(Student *s) {
    int complete = 1;
    float total = 0;

    for(int i = 0; i < numOfSubjects; i++) {
        if(s->subjectMarks[i] == -1) {
            complete = 0;
            break;
        }
        total += s->subjectMarks[i];
    }

    if(!complete) {
        s->aggregateMarks = -1;
        strcpy(s->grade, "undefined");
        return;
    }

    s->aggregateMarks = total / numOfSubjects;

    if(s->aggregateMarks >= 85) strcpy(s->grade, "HD");
    else if(s->aggregateMarks >= 75) strcpy(s->grade, "D");
    else if(s->aggregateMarks >= 65) strcpy(s->grade, "C");
    else if(s->aggregateMarks >= 50) strcpy(s->grade, "P");
    else strcpy(s->grade, "F");
}

void topStudents(Student students[], int n) {
    float max = -1;
    for(int i = 0; i < n; i++) {
        if(students[i].aggregateMarks > max)
            max = students[i].aggregateMarks;
    }

    if(max == -1) {
        printf("No complete records available.\n");
        return;
    }

    printf("\n--- Top Student(s) ---\n");
    for(int i = 0; i < n; i++) {
        if(students[i].aggregateMarks == max) {
            printf("ID: %d | %s %s | Aggregate: %.2f | Grade: %s\n",
                   students[i].studentID, students[i].firstName, students[i].lastName,
                   students[i].aggregateMarks, students[i].grade);
        }
    }
}

void enrol(Student students[], int n) {
    int id;
    printf("Enter Student ID: ");
    scanf("%d", &id);

    int index = findStudentByID(students, n, id);
    if(index == -1) {
        for(int i = 0; i < n; i++) {
            if(students[i].studentID == 0) {
                index = i;
                students[i].studentID = id;
                printf("Enter First Name: ");
                scanf("%s", students[i].firstName);
                printf("Enter Last Name: ");
                scanf("%s", students[i].lastName);
                break;
            }
        }
    }
    if(index == -1) {
        printf("No space for new student.\n");
        return;
    }
    
for(int i = 0; i < numOfSubjects; i++) {
        char choice[3];
        printf("Do you want to enter mark for Subject %d? (Yes/No): ", i);
        scanf("%s", choice);
        if(strcasecmp(choice, "Yes") == 0) {
            float mark;
            do {
                printf("Enter mark (0â€“100): ");
                scanf("%f", &mark);
                if(!validMark(mark))
                    printf("Invalid mark! Try again.\n");
            } while(!validMark(mark));
            students[index].subjectMarks[i] = mark;
        } else {
            students[index].subjectMarks[i] = -1;
        }
    }
calcGrade(&students[index]);
printf("Student record updated.\n");
}

void searchUpdate(Student students[], int n) {
    int choice;
    printf("Search by: 1.ID or 2.LastName ? ");
    scanf("%d", &choice);

    int index = -1;
    if(choice == 1) {
        int id;
        printf("Enter ID: ");
        scanf("%d", &id);
        index = findStudentByID(students, n, id);
    } else if(choice == 2) {
        char lname[30];
        printf("Enter Last Name: ");
        scanf("%s", lname);
        index = findStudentByLastName(students, n, lname);
    } else {
        printf("Invalid option.\n");
        return;
    }

    if(index == -1) {
        printf("Student not found.\n");
        return;
    }

void searchUpdate(Student students[], int n) {
    int choice;
    printf("Search by: 1.ID or 2.LastName ? ");
    scanf("%d", &choice);

    int index = -1;
    if(choice == 1) {
        int id;
        printf("Enter ID: ");
        scanf("%d", &id);
        index = findStudentByID(students, n, id);
    } else if(choice == 2) {
        char lname[30];
        printf("Enter Last Name: ");
        scanf("%s", lname);
        index = findStudentByLastName(students, n, lname);
    } else {
        printf("Invalid option.\n");
        return;
    }

    if(index == -1) {
        printf("Student not found.\n");
        return;
    }

  
