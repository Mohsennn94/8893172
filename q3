#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

#define MAX_NAME 100
#define MAX_LINE 200

typedef struct {
    char name[MAX_NAME];
    int mark;
} Student;

int validName(char *name) {
    if (strlen(name) == 0) return 1;

    for (int i = 0; name[i] != '\0'; i++) {
        if (!isprint(name[i])) return 1;   
        if (isdigit(name[i])) return 1;      
    }
    return 0;
}

int validMark(char *markStr, int *markValue) {
    
    if (strlen(markStr) == 0) return 1;

    char *end;
    long val = strtol(markStr, &end, 10);

    if (*end != '\0') return 1;

    *markValue = (int)val;
    return 0;
}

int main(){
  FILE *fp = fopen("students.txt", "r");

    if (!fp) {
        printf("Error: File not found.\n");
        return 0;
    }

}
 
char line[MAX_LINE];
int validCount = 0, corruptedCount = 0;
int sumMarks = 0;

printf("VALID RECORDS:\n");

while (fgets(line, sizeof(line), fp)) {

        line[strcspn(line, "\n")] = '\0';

        char *name = strtok(line, ",");
        char *markStr = strtok(NULL, ",");

        if (!name || !markStr) {
            corruptedCount++;
            continue;
        }

         if (!validName(name)) {
            corruptedCount++;
            continue;
        }

          int markValue = 0;
        if (!validMark(markStr, &markValue)) {
            corruptedCount++;
            continue;
        }

         printf("%s , %d\n", name, markValue);
        sumMarks += markValue;
        validCount++;
    }

fclose(fp)

printf("\n--- SUMMARY ---\n");
    printf("Total valid records: %d\n", validCount);
    printf("Total corrupted records: %d\n", corruptedCount);

    if (validCount > 0) {
        printf("Average mark (valid only): %.2f\n", (float)sumMarks / validCount);
    } else {
        printf("Average mark: N/A (no valid records)\n");
    }

    return 0;
}
